from PySide6.QtWidgets import QDialog, QVBoxLayout, QLabel, QTextEdit, QHBoxLayout, QPushButton
from PySide6.QtCore import Qt

DISCLAIMER_TEXT = (
    "拖把工具箱免责声明\n"
    "生效日期：2026年1月3日\n\n"
    "本免责声明（以下简称“本声明”）适用于所有使用 拖把工具箱（以下简称“本工具”）的用户（以下简称“您”）。请您在使用本工具前，务必仔细阅读并充分理解本声明的全部内容。您一旦开始使用本工具，即视为您已自愿接受本声明的约束，愿意承担因使用本工具所产生的全部风险及责任。若您不同意本声明的任何条款，请立即停止使用本工具。\n\n"
    "一、工具定位与使用前提\n\n"
    "1. 本工具是一款基于 Python 开发的开源安卓设备刷机适配工具，仅供技术学习、研究与交流使用，并非商业软件，商业服务请与开发者联系获取商业许可证。\n\n"
    "2. 本工具的使用以您的安卓设备已合法解锁 Bootloader 为前提，您确认已充分知晓解锁 Bootloader 及后续刷机操作可能带来的各项风险，并已获得设备的合法使用权，不存在任何权属争议。\n\n"
    "3. 本工具与任何设备厂商（包括但不限于华为、小米、一加、vivo等）无任何关联，不代表任何厂商的官方立场，亦未获得任何厂商的授权或背书。\n\n"
    "二、核心风险告知\n\n"
    "2.1 设备保修失效风险\n\n"
    "解锁 Bootloader、刷写非官方 ROM、获取 ROOT 权限等操作，将直接导致您的设备丧失厂商官方保修资格，且该操作通常不可逆。即使您后续恢复官方系统或重新锁定 Bootloader，厂商仍可能拒绝提供保修服务，包括但不限于硬件故障维修、系统问题排查等。\n\n"
    "2.2 设备损坏风险\n\n"
    "1. 因操作不当（包括但不限于未按教程操作、选择不兼容的 ROM 包、设备电量不足、数据线故障等）、设备硬件差异、系统兼容性问题等，可能导致设备出现 bootloop（循环重启）、无法开机（变砖）、功能异常（如信号丢失、相机失效、指纹失灵等）、硬件损坏等情况。\n\n"
    "2. 本工具虽已进行常规测试，但无法保证适配所有机型及硬件配置，亦无法预见所有可能的异常场景。若因本工具与您的设备不兼容导致设备损坏，您需自行承担维修或更换设备的全部成本。\n\n"
    "2.3 数据丢失与隐私泄露风险\n\n"
    "1. 刷机、解锁 Bootloader、分区刷写等操作通常会清除设备内的所有用户数据（包括但不限于照片、联系人、文档、应用数据等），即使选择“保留数据”模式，也存在数据损坏或丢失的风险。请您在操作前务必对重要数据进行全面备份，本工具不提供任何数据恢复服务，亦不承担数据丢失造成的任何直接或间接损失（包括但不限于商业数据丢失、隐私泄露引发的纠纷等）。\n\n"
    "2. 若您刷入的第三方 ROM 或使用的配置文件包含恶意程序、后门等，可能导致您的设备被入侵，隐私信息（如身份证信息、银行卡信息、聊天记录等）被窃取，本工具对此不承担任何责任，相关风险由您自行承担。\n\n"
    "2.4 软件与安全风险\n\n"
    "1. 刷写非官方 ROM 可能导致设备系统不稳定、存在安全漏洞，无法接收官方系统更新及安全补丁，进而增加设备被恶意攻击的风险。\n\n"
    "2. 获取 ROOT 权限后，若您向不可信应用授予 ROOT 权限，可能导致应用滥用权限，篡改系统文件、窃取数据或破坏设备功能。\n\n"
    "3. 本工具的开源特性允许用户修改代码，但修改后的衍生版本可能存在未知漏洞或风险，若您使用此类衍生版本导致损失，本工具原开发者不承担任何责任。\n\n"
    "三、责任限制与免责条款\n\n"
    "1. 本工具以“现状”提供，原开发者不提供任何明示或暗示的担保，包括但不限于对工具的适用性、稳定性、安全性、无故障性的担保，亦不保证本工具能够满足您的特定需求。\n\n"
    "2. 对于因使用本工具所产生的任何直接损失（如设备维修费用、数据恢复费用）、间接损失（如商业利益损失、业务中断损失、名誉损失等），本工具原开发者及贡献者不承担任何赔偿责任，无论该损失是否因疏忽、错误、遗漏或其他原因导致。\n\n"
    "3. 因第三方资源（包括但不限于第三方 ROM 包、配置文件、驱动程序、固件资源等）存在问题导致的任何风险与损失，由您与第三方自行解决，本工具原开发者不承担任何连带责任。\n\n"
    "4. 因不可抗力（包括但不限于自然灾害、战争、政府管制、网络攻击、服务器故障、软件版本更新中断等）导致本工具无法正常使用或操作失败，进而造成的损失，本工具原开发者不承担任何责任。\n\n"
    "5. 您承诺仅在符合所在地区法律法规及相关政策的前提下使用本工具，不得利用本工具进行任何违法违规行为（包括但不限于刷写盗版 ROM、破解设备锁、窃取他人设备数据、传播恶意软件等）。若您的使用行为违反法律法规，导致任何法律纠纷、行政处罚或第三方索赔，均由您自行承担全部责任，与本工具原开发者无关。\n\n"
    "四、知识产权与使用限制\n\n"
    "1. 本工具基于 GNU General Public License v3.0 开源，您有权自由使用、修改、分发本工具的源代码及衍生版本，但需严格遵守 GNU General Public License v3.0 的相关规定，保留原作者的版权声明及本免责声明，不得删除或篡改相关知识产权信息。\n\n"
    "2. 您不得将本工具及衍生版本用于商业用途（包括但不限于出售、出租、作为商业服务的一部分提供给他人等），不得通过修改本工具进行恶意推广、植入广告或获取非法利益，否则需承担相应的法律责任。\n\n"
    "3. 本工具中集成的第三方组件（包括但不限于 ADB、fastboot、Scrcpy 等），其知识产权归各自的开发者所有，您需遵守相应的许可协议，本工具原开发者不承担第三方组件引发的任何知识产权纠纷责任。\n\n"
    "五、免责例外\n\n"
    "仅在本工具原开发者存在故意或重大过失（如恶意植入恶意程序、故意隐瞒重大安全漏洞等）的情况下，导致您遭受直接损失的，您可依法向原开发者主张赔偿责任。除此之外，本声明中的免责条款均具有法律效力。\n\n"
    "六、其他条款\n\n"
    "1. 本声明的解释权归本工具原开发者所有。原开发者有权根据实际情况对本声明进行修改或更新，修改后的声明将在本工具的 GitHub 仓库显著位置公示，您继续使用本工具即视为接受修改后的声明。若您对修改后的声明有异议，应立即停止使用本工具。\n\n"
    "2. 若本声明中的任何条款与您所在地区的法律法规相冲突，该条款将视为无效，但不影响其他条款的法律效力。\n\n"
    "3. 您在使用本工具过程中产生的任何争议，应首先通过友好协商解决；协商不成的，您同意将争议提交至本工具原开发者所在地有管辖权的人民法院诉讼解决。\n\n"
    "再次提醒：刷机操作具有较高风险，请您谨慎操作，确保充分了解相关风险并做好应对准备。使用本工具即表示您已通读并同意本声明的全部内容。\n\n"
    "Tobatools 开发团队 敬上"
)


class DisclaimerDialog(QDialog):
    def __init__(self, parent=None):
        super().__init__(parent)
        self.setWindowTitle("免责声明")
        self.setModal(True)
        self.resize(680, 460)

        layout = QVBoxLayout(self)
        title = QLabel("请仔细阅读以下免责声明：")
        title.setProperty("heading", True)
        layout.addWidget(title)

        text = QTextEdit()
        text.setReadOnly(True)
        text.setPlainText(DISCLAIMER_TEXT)
        layout.addWidget(text, 1)

        btn_row = QHBoxLayout()
        btn_row.addStretch(1)
        self.btn_disagree = QPushButton("不同意并退出")
        self.btn_agree = QPushButton("同意并继续")
        btn_row.addWidget(self.btn_disagree)
        btn_row.addWidget(self.btn_agree)
        layout.addLayout(btn_row)

        self.btn_disagree.clicked.connect(self.reject)
        self.btn_agree.clicked.connect(self.accept)
